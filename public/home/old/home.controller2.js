!function(){"use strict";function e(e,t,s,n){function i(e){return f.resjsontasks.filter(t=>t.id_list==e)}function l(e){for(let t=0;t<e.length;t++)f["list_"+e[t].id]=i(e[t].id),f["list_"+e[t].id].name=e[t].name,f.rawScreens.push(f["list_"+e[t].id])}function o(e,t){event.preventDefault(),f["list_"+e].splice(_.indexOf(f["list_"+e],_.find(f["list_"+e],function(e){return e.id===t})),1),f.resjsontasks.splice(_.indexOf(f.resjsontasks,_.find(f.resjsontasks,function(e){return e.id===t})),1)}function r(){f.rawScreens=[],l(f.resgetJsonLists)}function a(e,t,s){event.preventDefault();let n=_.find(f["list_"+e],function(e){return e.id===t});for(let e in n)f["html_"+e]=n[e];f.html_t_index=s+1,$("#openModal").fadeToggle()}function d(e,t){return $.map(e,function(e,s){if(e.id==t)return s})[0]}function c(){e.GetAll().then(function(e){f.allUsers=e})}var f=this;f.tasck_limit=15,f.ngGridView=null,f.user=null,f.allUsers=[],f.deleteUser=function(t){e.Delete(t).then(function(){c()})},f.exit_modal=function(){event.preventDefault(),$(".modalDialog").fadeToggle()},f.savetasck=function(e,t,s){if(event.preventDefault(),1==confirm("Сохранить?")){let e=d(f.resjsontasks,t);for(let t in f.resjsontasks[0])"$$hashKey"!=t&&("date"==t||"title"==t?"date"==t?f.resjsontasks[e].date=$("#dtpckr")[0].value:f.resjsontasks[e].title=$("#ttl")[0].value:f.resjsontasks[e][t]=f["html_"+t]);1==f.change&&(r(),f.change=!1)}$(".modalDialog").fadeToggle()},f.edittasck=a,f.deltasck=o,f.addtasck=function(e){if(event.preventDefault(),f["list_"+e].length<f.tasck_limit){var t=f.resjsontasks[0];let s="{";for(let n in t)"id"!=n?"title"==n?s=s+'"'+n+'": "NewTasck '+e+g+'",':"id_list"==n?s=s+'"'+n+'": '+Number(e)+",":"description"==n||"date"==n?s="date"==n?s+'"'+n+'" : "08.12.2017",':s+'"'+n+'" : "1",':"$$hashKey"!=n&&(s=s+'"'+n+'" : 1,'):s=s+'"id" : '+Math.floor(Date.now()/1e3)+",";s=s.slice(0,-1),s+="}",console.log(s),f.resjsontasks.push(JSON.parse(s)),r(),g++}},f.def_click=function(){event.preventDefault()},f.finish_loader=function(){$("#loader").is(":visible")&&$("#loader").fadeToggle()},f.start_loader=function(){$("#loader").is(":visible")||$("#loader").fadeToggle()},f.logModels=function(){f.sortingLog=[];for(let t=0;t<f.rawScreens.length;t++){var e=f.rawScreens[t].map(function(e){return e.title+"-"+e.id_list+"|"}).join(", ");e="container "+(t+1)+": "+e,f.sortingLog.push(e)}},f.my_alert=function(e,t,s="def"){if(console.log(f.allUsers),0==s&&o(t,e),1==s){let s=null;for(let n=0;n<f["list_"+t].length;n++)f["list_"+t][n].id==e&&(s=n);a(t,e,s)}},f.change_list=function(){f.change=!0},f.change=!1,f.clickHandler={onClick:function(e){alert("Name: "+e)}},f.rawScreens=[],f.sortingLog=[],f.resjsontasks=[],f.resgetJsonLists=[],f.sortableOptions={placeholder:"app",connectWith:".apps-container",update:function(e,t){!t.item.sortable.received&&t.item.sortable.source[0]!==t.item.sortable.droptarget[0]&&t.item.sortable.droptargetModel.length>=f.tasck_limit&&t.item.sortable.cancel()},stop:function(e,t){for(let e=0;e<f.rawScreens.length;e++)f.rawScreens[e].map(function(t){t.id_list=e+1})}},f.status=[{id:1,name:"Ожидает"},{id:2,name:"В работе"},{id:3,name:"Выполнено"}],$("#dtpckr").datepicker();var u=[];e.GetByUsername(n.globals.currentUser.username).then(function(e){f.user=e}),c(),f.resgetJsonLists=t.getResultFromJson("db/listsName.json"),f.resjsontasks=t.getResultFromJson("db/tasks.json"),u=t.getResultFromJson("db/gridname.json"),l(f.resgetJsonLists),function(){f.gridOptions={enableFiltering:!0,showFooter:!0,onRegisterApi:function(e){f.gridApi=e},columnDefs:[]};let e,t=u.sort((e,t)=>e.sort-t.sort);for(let s=0;s<t.length;s++)"$$hashKey"!=t[s].id&&(e='{"field" : "'+t[s].id+'","displayName" : "'+u[s].gridname+'"}',f.gridOptions.columnDefs.push(JSON.parse(e)));let s=["id"];for(let e=0;e<s.length;e++)for(let t=0;t<f.gridOptions.columnDefs.length;t++)if(f.gridOptions.columnDefs[t].field==s[e])f.gridOptions.columnDefs[t].visible=!1;else{let e=d(u,f.gridOptions.columnDefs[t].field);f.gridOptions.columnDefs[t].displayName=u[e].gridname,f.gridOptions.columnDefs[t].width=u[e].width}let n="<i class='fa fa-pencil-square-o btn btn-success btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,1)'></i>\"";e='{"field": "edit", "displayName": "...", "width": 40, "cellTemplate": "'+n+"}",f.gridOptions.columnDefs.push(JSON.parse(e)),e='{"field": "delete", "displayName": "...", "width": 40, "cellTemplate": "'+(n="<div><i class='fa fa-trash-o btn btn-danger btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,0)'></div>\"")+"}",f.gridOptions.columnDefs.push(JSON.parse(e));for(let t=0;t<f.gridOptions.columnDefs.length;t++){let s;"id_list"!=f.gridOptions.columnDefs[t].field&&"execution_status"!=f.gridOptions.columnDefs[t].field||(s="id_list"==f.gridOptions.columnDefs[t].field?'{"value": "1", "label": "План" }, { "value": "2", "label": "В процессе" }, { "value": "3", "label": "Готово"}':'{"value": "1", "label": "Ожидает" }, { "value": "2", "label": "В работе" }, { "value": "3", "label": "Выполнено"}',e='{"type" : "select","selectOptions"  : [ '+s+"]}",f.gridOptions.columnDefs[t].filter=JSON.parse(e)),"edit"!=f.gridOptions.columnDefs[t].field&&"delete"!=f.gridOptions.columnDefs[t].field||(f.gridOptions.columnDefs[t].enableFiltering=!1)}f.gridOptions.data=f.resjsontasks}();var g=0}angular.module("app").controller("HomeController",e),e.$inject=["UserService","JsonService","uiGridConstants","$rootScope"]}();