!function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};t.m=e,t.c=i,t.p="/js/",t(0)}([function(e,t){"use strict";!function(){function e(e,t,i,n,s,r,o){function l(e){return 1!=v.user.id?v.resjsontasks.filter(function(t){return t.id_list==e&&t.id_user==v.user.id}):v.resjsontasks.filter(function(t){return t.id_list==e})}function a(t){if(S)for(var i=0;i<t.length;i++)v["list_"+t[i].id]=l(t[i].id),v["list_"+t[i].id].name=t[i].name,v.rawScreens.push(v["list_"+t[i].id]);else e.GetByUsername(r.globals.currentUser.username).then(function(e){v.user=e;for(var i=0;i<t.length;i++)v["list_"+t[i].id]=l(t[i].id),v["list_"+t[i].id].name=t[i].name,v.rawScreens.push(v["list_"+t[i].id]);S=!0,function(){v.gridOptions={paginationPageSizes:[2,3,5,10],paginationPageSize:10,enableGridMenu:!0,enableCellEdit:!1,enableColumnResizing:!0,enableFiltering:!0,showGridFooter:!0,onRegisterApi:function(e){v.gridApi=e},columnDefs:[],gridMenuCustomItems:[{title:"Внешняя функция1",action:function(e){alert("!!!!!!!!!!!")},icon:"fa fa-pencil-square-o"}]};for(var e=void 0,t=h.sort(function(e,t){return e.sort-t.sort}),i=0;i<t.length;i++)"$$hashKey"!=t[i].id&&(e='{"field" : "'+t[i].id+'","displayName" : "'+h[i].gridname+'"}',v.gridOptions.columnDefs.push(JSON.parse(e)));for(var n=["id"],s=0;s<n.length;s++)for(var r=0;r<v.gridOptions.columnDefs.length;r++)if(v.gridOptions.columnDefs[r].field==n[s])v.gridOptions.columnDefs[r].visible=!1;else{var o=p(h,v.gridOptions.columnDefs[r].field);v.gridOptions.columnDefs[r].displayName=h[o].gridname,v.gridOptions.columnDefs[r].width=h[o].width}var l="<i class='fa fa-pencil-square-o btn btn-success btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,1)'></i>\"";e='{"field": "edit", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+l+"}",v.gridOptions.columnDefs.push(JSON.parse(e)),e='{"field": "delete", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+(l="<div><i class='fa fa-trash-o btn btn-danger btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,0)'></div>\"")+"}",v.gridOptions.columnDefs.push(JSON.parse(e));for(var a=void 0,d=0;d<v.gridOptions.columnDefs.length;d++)"id_list"!=v.gridOptions.columnDefs[d].field&&"execution_status"!=v.gridOptions.columnDefs[d].field||(a="id_list"==v.gridOptions.columnDefs[d].field?'{"value": "1", "label": "План" }, { "value": "2", "label": "В процессе" }, { "value": "3", "label": "Готово"}':'{"value": "1", "label": "Ожидает" }, { "value": "2", "label": "В работе" }, { "value": "3", "label": "Выполнено"}',e='{"type" : "select","selectOptions"  : [ '+a+"]}",v.gridOptions.columnDefs[d].filter=JSON.parse(e),"id_list"==v.gridOptions.columnDefs[d].field?v.gridOptions.columnDefs[d].cellFilter="id_list":v.gridOptions.columnDefs[d].cellFilter="execution_status"),"edit"!=v.gridOptions.columnDefs[d].field&&"delete"!=v.gridOptions.columnDefs[d].field||(v.gridOptions.columnDefs[d].enableFiltering=!1);c()}()})}function d(e,t){event.preventDefault(),v["list_"+e].splice(_.indexOf(v["list_"+e],_.find(v["list_"+e],function(e){return e.id===t})),1),1!=v.user.id?(v.resjsontasks.splice(_.indexOf(v.resjsontasks,_.find(v.resjsontasks,function(e){return e.id===t})),1),v.gridOptions.data=v.resjsontasks.filter(function(e){return e.id_user==v.user.id})):v.resjsontasks.splice(_.indexOf(v.resjsontasks,_.find(v.resjsontasks,function(e){return e.id===t})),1)}function u(){v.rawScreens=[],a(v.resgetJsonLists)}function c(){1!=v.user.id?v.gridOptions.data=v.resjsontasks.filter(function(e){return e.id_user==v.user.id}):v.gridOptions.data=v.resjsontasks}function f(e,t,i){event.preventDefault();var n=_.find(v["list_"+e],function(e){return e.id===t});for(var s in n)v["html_"+s]=n[s];v.html_t_index=i+1,$("#openModal").fadeToggle()}function p(e,t){return $.map(e,function(e,i){if(e.id==t)return i})[0]}function g(){alert("send")}function m(){e.GetAll().then(function(e){v.allUsers=e,t.Users=v.allUsers})}var v=this;v.tasck_limit=15,v.ngGridView=null,v.user=null,v.allUsers=[],v.deleteUser=function(t){e.Delete(t).then(function(){m()})},v.exit_modal=function(){event.preventDefault(),$(".modalDialog").fadeToggle()},v.savetasck=function(e,t,i){if(event.preventDefault(),1==confirm("Сохранить?")){var n=p(v.resjsontasks,t);for(var s in v.resjsontasks[0])"$$hashKey"!=s&&("date"==s||"title"==s?"date"==s?v.resjsontasks[n].date=$("#dtpckr")[0].value:v.resjsontasks[n].title=$("#ttl")[0].value:v.resjsontasks[n][s]=v["html_"+s]);1==v.change&&(u(),c(),v.change=!1)}$(".modalDialog").fadeToggle()},v.edittasck=f,v.deltasck=d,v.addtasck=function(e){if(event.preventDefault(),v["list_"+e].length<v.tasck_limit){var t=v.resjsontasks[0],i="{";for(var n in t)"id"!=n?"title"==n?i=i+'"'+n+'": "NewTasck '+e+D+'",':"id_list"==n?i=i+'"'+n+'": '+Number(e)+",":"id_user"==n?i=i+'"'+n+'": '+v.user.id+",":"description"==n||"date"==n?i="date"==n?i+'"'+n+'" : "08.12.2017",':i+'"'+n+'" : "1",':"$$hashKey"!=n&&(i=i+'"'+n+'" : 1,'):i=i+'"id" : '+Math.floor(Date.now()/1e3)+",";i=i.slice(0,-1),i+="}",v.resjsontasks.push(JSON.parse(i)),u(),c(),D++}},v.def_click=function(){event.preventDefault()},v.exportPDF=function(){event.preventDefault(),v.gridApi.exporter.pdfExport(n.VISIBLE,n.VISIBLE)},v.exportCSV=function(){event.preventDefault();var e=s,t=v.gridApi.grid,i=function(){var e=new Date,t=e.getDate(),i=e.getMonth()+1,n=e.getFullYear();return t<10&&(t="0"+t),i<10&&(i="0"+i),e=i+"_"+t+"_"+n}()+".csv";e.loadAllDataIfNeeded(t,n.VISIBLE,n.VISIBLE).then(function(){var s=e.getColumnHeaders(t,n.VISIBLE),r=e.getData(t,n.VISIBLE,n.VISIBLE),o=e.formatAsCsv(s,r,t.options.exporterCsvColumnSeparator=";");e.downloadFile(i,o,t.options.exporterOlderExcelCompatibility),alert("Загрузится файл "+i)})},v.gmail=function(){event.preventDefault();var e=s,t=v.gridApi.grid;e.loadAllDataIfNeeded(t,n.VISIBLE,n.VISIBLE).then(function(){var i=e.getColumnHeaders(t,n.VISIBLE),s=e.getData(t,n.VISIBLE,n.VISIBLE);v.csvContent=e.formatAsCsv(i,s,t.options.exporterCsvColumnSeparator=";");let r,o=v.csvContent.split("\n");r="<tr>";for(var l=0;l<o.length;l++){let e=o[l].split(";");for(var a=0;a<e.length;a++)r=0==l?r+"<th>"+e[a]+"</th>":r+"<td>"+e[a]+"</td>";r+="</tr>"}$.ajax({url:"../mail.php",type:"POST",data:{to:v.mailAddress,sub:"Export",emailbody:r},dataType:"html",success:g})}),$("#address").fadeToggle()},v.address=function(){$("#address").fadeToggle()},v.mailAddress="@gmail.com",v.finish_loader=function(){$("#loader").is(":visible")&&$("#loader").fadeToggle()},v.start_loader=function(){$("#loader").is(":visible")||$("#loader").fadeToggle()},v.logModels=function(){v.sortingLog=[];for(var e=0;e<v.rawScreens.length;e++){var t=v.rawScreens[e].map(function(e){return e.title+"-"+e.id_list+"|"}).join(", ");t="container "+(e+1)+": "+t,v.sortingLog.push(t)}},v.my_alert=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"def";if(0==i&&d(t,e),1==i){for(var n=null,s=0;s<v["list_"+t].length;s++)v["list_"+t][s].id==e&&(n=s);f(t,e,n)}},v.change_list=function(){v.change=!0},v.change=!1,v.rawScreens=[],v.sortingLog=[],v.resjsontasks=[],v.resgetJsonLists=[],v.sortableOptions={placeholder:"app",connectWith:".apps-container",update:function(e,t){!t.item.sortable.received&&t.item.sortable.source[0]!==t.item.sortable.droptarget[0]&&t.item.sortable.droptargetModel.length>=v.tasck_limit&&t.item.sortable.cancel()},stop:function(e,t){for(var i=function(e){v.rawScreens[e].map(function(t){t.id_list=e+1})},n=0;n<v.rawScreens.length;n++)i(n)}},v.status=[{id:1,name:"Ожидает"},{id:2,name:"В работе"},{id:3,name:"Выполнено"}],$("#dtpckr").datepicker();var h=[],S=!1;m(),v.resgetJsonLists=t.getResultFromJson("db/listsName.json"),t.list=v.resgetJsonLists,v.resjsontasks=t.getResultFromJson("db/tasks.json"),h=t.getResultFromJson("db/gridname.json"),a(v.resgetJsonLists),v.getProductList=function(){if(v.gridOptions.data=v.resultSimulatedData,v.mySelectedRows=v.gridApi.selection.getSelectedRows(),v.mySelectedRows[0]){for(var e=void 0,t=0;t<v.mySelectedRows.length;t++)e=e+"Выбрано : "+(t+1)+" ИД = "+v.mySelectedRows[t].id+", Лист = "+v.mySelectedRows[t].id_list+".\n";alert(e.slice(9))}else alert("Ничего не выбрано");o(function(){v.gridApi.selection.selectedRow&&v.gridApi.selection.selectRow(v.gridOptions.data[0])})};var D=0;v.address}angular.module("app").controller("HomeController",e).filter("id_list",function(){var e={1:"План",2:"В процессе",3:"Готово"};return function(t){return t?e[t]:""}}).filter("execution_status",function(){var e={1:"Ожидает",2:"В работе",3:"Выполнено"};return function(t){return t?e[t]:""}}),e.$inject=["UserService","HomeService","uiGridConstants","uiGridExporterConstants","uiGridExporterService","$rootScope","$timeout"]}()}]);