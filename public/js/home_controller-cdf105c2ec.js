!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};t.m=e,t.c=i,t.p="/js/",t(0)}([function(e,t){"use strict";!function(){function e(e,t,i,s,n){function r(e){return 1!=p.user.id?p.resjsontasks.filter(function(t){return t.id_list==e&&t.id_user==p.user.id}):p.resjsontasks.filter(function(t){return t.id_list==e})}function l(t){if(m)for(var i=0;i<t.length;i++)p["list_"+t[i].id]=r(t[i].id),p["list_"+t[i].id].name=t[i].name,p.rawScreens.push(p["list_"+t[i].id]);else e.GetByUsername(s.globals.currentUser.username).then(function(e){p.user=e;for(var i=0;i<t.length;i++)p["list_"+t[i].id]=r(t[i].id),p["list_"+t[i].id].name=t[i].name,p.rawScreens.push(p["list_"+t[i].id]);m=!0,function(){p.gridOptions={enableCellEdit:!1,enableColumnResizing:!0,enableFiltering:!0,showGridFooter:!0,onRegisterApi:function(e){p.gridApi=e},columnDefs:[]};for(var e=void 0,t=g.sort(function(e,t){return e.sort-t.sort}),i=0;i<t.length;i++)"$$hashKey"!=t[i].id&&(e='{"field" : "'+t[i].id+'","displayName" : "'+g[i].gridname+'"}',p.gridOptions.columnDefs.push(JSON.parse(e)));for(var s=["id"],n=0;n<s.length;n++)for(var r=0;r<p.gridOptions.columnDefs.length;r++)if(p.gridOptions.columnDefs[r].field==s[n])p.gridOptions.columnDefs[r].visible=!1;else{var l=c(g,p.gridOptions.columnDefs[r].field);p.gridOptions.columnDefs[r].displayName=g[l].gridname,p.gridOptions.columnDefs[r].width=g[l].width}var o="<i class='fa fa-pencil-square-o btn btn-success btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,1)'></i>\"";e='{"field": "edit", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+o+"}",p.gridOptions.columnDefs.push(JSON.parse(e)),e='{"field": "delete", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+(o="<div><i class='fa fa-trash-o btn btn-danger btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,0)'></div>\"")+"}",p.gridOptions.columnDefs.push(JSON.parse(e));for(var a=void 0,u=0;u<p.gridOptions.columnDefs.length;u++)"id_list"!=p.gridOptions.columnDefs[u].field&&"execution_status"!=p.gridOptions.columnDefs[u].field||(a="id_list"==p.gridOptions.columnDefs[u].field?'{"value": "1", "label": "План" }, { "value": "2", "label": "В процессе" }, { "value": "3", "label": "Готово"}':'{"value": "1", "label": "Ожидает" }, { "value": "2", "label": "В работе" }, { "value": "3", "label": "Выполнено"}',e='{"type" : "select","selectOptions"  : [ '+a+"]}",p.gridOptions.columnDefs[u].filter=JSON.parse(e),"id_list"==p.gridOptions.columnDefs[u].field?p.gridOptions.columnDefs[u].cellFilter="id_list":p.gridOptions.columnDefs[u].cellFilter="execution_status"),"edit"!=p.gridOptions.columnDefs[u].field&&"delete"!=p.gridOptions.columnDefs[u].field||(p.gridOptions.columnDefs[u].enableFiltering=!1),"id_user"==p.gridOptions.columnDefs[u].field&&function(){p.gridOptions.columnDefs[u].cellFilter="id_user";var t=void 0;1==p.user.id?p.allUsers.map(function(e){return t=t+'{"value": "'+e.id+'", "label": "'+e.username+'" },'}):p.allUsers.map(function(e){e.id==p.user.id&&(t=t+'{"value": "'+e.id+'", "label": "'+e.username+'" },')}),e='{"type" : "select","selectOptions"  :  ['+t.slice(9,-1)+"]}",p.gridOptions.columnDefs[u].filter=JSON.parse(e)}();d()}()})}function o(e,t){event.preventDefault(),p["list_"+e].splice(_.indexOf(p["list_"+e],_.find(p["list_"+e],function(e){return e.id===t})),1),1!=p.user.id?(p.resjsontasks.splice(_.indexOf(p.resjsontasks,_.find(p.resjsontasks,function(e){return e.id===t})),1),p.gridOptions.data=p.resjsontasks.filter(function(e){return e.id_user==p.user.id})):p.resjsontasks.splice(_.indexOf(p.resjsontasks,_.find(p.resjsontasks,function(e){return e.id===t})),1)}function a(){p.rawScreens=[],l(p.resgetJsonLists)}function d(){1!=p.user.id?p.gridOptions.data=p.resjsontasks.filter(function(e){return e.id_user==p.user.id}):p.gridOptions.data=p.resjsontasks}function u(e,t,i){event.preventDefault();var s=_.find(p["list_"+e],function(e){return e.id===t});for(var n in s)p["html_"+n]=s[n];p.html_t_index=i+1,$("#openModal").fadeToggle()}function c(e,t){return $.map(e,function(e,i){if(e.id==t)return i})[0]}function f(){e.GetAll().then(function(e){p.allUsers=e,t.Users=p.allUsers})}var p=this;p.tasck_limit=15,p.ngGridView=null,p.user=null,p.allUsers=[],p.deleteUser=function(t){e.Delete(t).then(function(){f()})},p.exit_modal=function(){event.preventDefault(),$(".modalDialog").fadeToggle()},p.savetasck=function(e,t,i){if(event.preventDefault(),1==confirm("Сохранить?")){var s=c(p.resjsontasks,t);for(var n in p.resjsontasks[0])"$$hashKey"!=n&&("date"==n||"title"==n?"date"==n?p.resjsontasks[s].date=$("#dtpckr")[0].value:p.resjsontasks[s].title=$("#ttl")[0].value:p.resjsontasks[s][n]=p["html_"+n]);1==p.change&&(a(),d(),p.change=!1)}$(".modalDialog").fadeToggle()},p.edittasck=u,p.deltasck=o,p.addtasck=function(e){if(event.preventDefault(),p["list_"+e].length<p.tasck_limit){var t=p.resjsontasks[0],i="{";for(var s in t)"id"!=s?"title"==s?i=i+'"'+s+'": "NewTasck '+e+v+'",':"id_list"==s?i=i+'"'+s+'": '+Number(e)+",":"id_user"==s?i=i+'"'+s+'": '+p.user.id+",":"description"==s||"date"==s?i="date"==s?i+'"'+s+'" : "08.12.2017",':i+'"'+s+'" : "1",':"$$hashKey"!=s&&(i=i+'"'+s+'" : 1,'):i=i+'"id" : '+Math.floor(Date.now()/1e3)+",";i=i.slice(0,-1),i+="}",p.resjsontasks.push(JSON.parse(i)),a(),d(),v++}},p.def_click=function(){event.preventDefault()},p.finish_loader=function(){$("#loader").is(":visible")&&$("#loader").fadeToggle()},p.start_loader=function(){$("#loader").is(":visible")||$("#loader").fadeToggle()},p.logModels=function(){p.sortingLog=[];for(var e=0;e<p.rawScreens.length;e++){var t=p.rawScreens[e].map(function(e){return e.title+"-"+e.id_list+"|"}).join(", ");t="container "+(e+1)+": "+t,p.sortingLog.push(t)}},p.my_alert=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"def";if(0==i&&o(t,e),1==i){for(var s=null,n=0;n<p["list_"+t].length;n++)p["list_"+t][n].id==e&&(s=n);u(t,e,s)}},p.change_list=function(){p.change=!0},p.change=!1,p.rawScreens=[],p.sortingLog=[],p.resjsontasks=[],p.resgetJsonLists=[],p.sortableOptions={placeholder:"app",connectWith:".apps-container",update:function(e,t){!t.item.sortable.received&&t.item.sortable.source[0]!==t.item.sortable.droptarget[0]&&t.item.sortable.droptargetModel.length>=p.tasck_limit&&t.item.sortable.cancel()},stop:function(e,t){for(var i=function(e){p.rawScreens[e].map(function(t){t.id_list=e+1})},s=0;s<p.rawScreens.length;s++)i(s)}},p.status=[{id:1,name:"Ожидает"},{id:2,name:"В работе"},{id:3,name:"Выполнено"}],$("#dtpckr").datepicker();var g=[],m=!1;f(),p.resgetJsonLists=t.getResultFromJson("db/listsName.json"),t.list=p.resgetJsonLists,p.resjsontasks=t.getResultFromJson("db/tasks.json"),g=t.getResultFromJson("db/gridname.json"),l(p.resgetJsonLists),p.getProductList=function(){if(p.gridOptions.data=p.resultSimulatedData,p.mySelectedRows=p.gridApi.selection.getSelectedRows(),p.mySelectedRows[0]){for(var e=void 0,t=0;t<p.mySelectedRows.length;t++)e=e+"Выбрано : "+(t+1)+" ИД = "+p.mySelectedRows[t].id+", Лист = "+p.mySelectedRows[t].id_list+".\n";alert(e.slice(9))}else alert("Ничего не выбрано");n(function(){p.gridApi.selection.selectedRow&&p.gridApi.selection.selectRow(p.gridOptions.data[0])})};var v=0}function t(e,t,i){for(var s="{",n=0;n<e.length;n++)s=s+'"'+e[n][t]+'": "'+e[n][i]+'", ';return s=s.slice(0,-2)+"}",JSON.parse(s)}angular.module("app").controller("HomeController",e).filter("id_list",function(e){var i=t(e.list,"id","name");return function(e){return e?i[e]:""}}).filter("execution_status",function(e){var t=e.status;return function(e){return e?t[e]:""}}).filter("id_user",function(e){var i=t(e.Users,"id","username");return function(e){return e?i[e]:""}}),e.$inject=["UserService","JsonService","uiGridConstants","$rootScope","$timeout"]}()}]);