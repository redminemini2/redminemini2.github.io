!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};t.m=e,t.c=i,t.p="/js/",t(0)}([function(e,t){"use strict";!function(){function e(e,t,i,s,n){function r(e){return 1!=g.user.id?g.resjsontasks.filter(function(t){return t.id_list==e&&t.id_user==g.user.id}):g.resjsontasks.filter(function(t){return t.id_list==e})}function o(t){if(m)for(var i=0;i<t.length;i++)g["list_"+t[i].id]=r(t[i].id),g["list_"+t[i].id].name=t[i].name,g.rawScreens.push(g["list_"+t[i].id]);else e.GetByUsername(s.globals.currentUser.username).then(function(e){g.user=e;for(var i=0;i<t.length;i++)g["list_"+t[i].id]=r(t[i].id),g["list_"+t[i].id].name=t[i].name,g.rawScreens.push(g["list_"+t[i].id]);m=!0,function(){g.gridOptions={enableCellEdit:!1,enableColumnResizing:!0,enableFiltering:!0,showGridFooter:!0,onRegisterApi:function(e){g.gridApi=e},columnDefs:[]};for(var e=void 0,t=p.sort(function(e,t){return e.sort-t.sort}),i=0;i<t.length;i++)"$$hashKey"!=t[i].id&&(e='{"field" : "'+t[i].id+'","displayName" : "'+p[i].gridname+'"}',g.gridOptions.columnDefs.push(JSON.parse(e)));for(var s=["id"],n=0;n<s.length;n++)for(var r=0;r<g.gridOptions.columnDefs.length;r++)if(g.gridOptions.columnDefs[r].field==s[n])g.gridOptions.columnDefs[r].visible=!1;else{var o=u(p,g.gridOptions.columnDefs[r].field);g.gridOptions.columnDefs[r].displayName=p[o].gridname,g.gridOptions.columnDefs[r].width=p[o].width}var l="<i class='fa fa-pencil-square-o btn btn-success btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,1)'></i>\"";e='{"field": "edit", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+l+"}",g.gridOptions.columnDefs.push(JSON.parse(e)),e='{"field": "delete", "enableSorting": false, "displayName": "...", "width": 38, "cellTemplate": "'+(l="<div><i class='fa fa-trash-o btn btn-danger btn-sm' ng-click='grid.appScope.vm.my_alert(row.entity.id,row.entity.id_list,0)'></div>\"")+"}",g.gridOptions.columnDefs.push(JSON.parse(e));for(var a=void 0,c=0;c<g.gridOptions.columnDefs.length;c++)"id_list"!=g.gridOptions.columnDefs[c].field&&"execution_status"!=g.gridOptions.columnDefs[c].field||(a="id_list"==g.gridOptions.columnDefs[c].field?'{"value": "1", "label": "План" }, { "value": "2", "label": "В процессе" }, { "value": "3", "label": "Готово"}':'{"value": "1", "label": "Ожидает" }, { "value": "2", "label": "В работе" }, { "value": "3", "label": "Выполнено"}',e='{"type" : "select","selectOptions"  : [ '+a+"]}",g.gridOptions.columnDefs[c].filter=JSON.parse(e),"id_list"==g.gridOptions.columnDefs[c].field?g.gridOptions.columnDefs[c].cellFilter="id_list":g.gridOptions.columnDefs[c].cellFilter="execution_status"),"edit"!=g.gridOptions.columnDefs[c].field&&"delete"!=g.gridOptions.columnDefs[c].field||(g.gridOptions.columnDefs[c].enableFiltering=!1);d()}()})}function l(e,t){event.preventDefault(),g["list_"+e].splice(_.indexOf(g["list_"+e],_.find(g["list_"+e],function(e){return e.id===t})),1),1!=g.user.id?(g.resjsontasks.splice(_.indexOf(g.resjsontasks,_.find(g.resjsontasks,function(e){return e.id===t})),1),g.gridOptions.data=g.resjsontasks.filter(function(e){return e.id_user==g.user.id})):g.resjsontasks.splice(_.indexOf(g.resjsontasks,_.find(g.resjsontasks,function(e){return e.id===t})),1)}function a(){g.rawScreens=[],o(g.resgetJsonLists)}function d(){1!=g.user.id?g.gridOptions.data=g.resjsontasks.filter(function(e){return e.id_user==g.user.id}):g.gridOptions.data=g.resjsontasks}function c(e,t,i){event.preventDefault();var s=_.find(g["list_"+e],function(e){return e.id===t});for(var n in s)g["html_"+n]=s[n];g.html_t_index=i+1,$("#openModal").fadeToggle()}function u(e,t){return $.map(e,function(e,i){if(e.id==t)return i})[0]}function f(){e.GetAll().then(function(e){g.allUsers=e,t.Users=g.allUsers})}var g=this;g.tasck_limit=15,g.ngGridView=null,g.user=null,g.allUsers=[],g.deleteUser=function(t){e.Delete(t).then(function(){f()})},g.exit_modal=function(){event.preventDefault(),$(".modalDialog").fadeToggle()},g.savetasck=function(e,t,i){if(event.preventDefault(),1==confirm("Сохранить?")){var s=u(g.resjsontasks,t);for(var n in g.resjsontasks[0])"$$hashKey"!=n&&("date"==n||"title"==n?"date"==n?g.resjsontasks[s].date=$("#dtpckr")[0].value:g.resjsontasks[s].title=$("#ttl")[0].value:g.resjsontasks[s][n]=g["html_"+n]);1==g.change&&(a(),d(),g.change=!1)}$(".modalDialog").fadeToggle()},g.edittasck=c,g.deltasck=l,g.addtasck=function(e){if(event.preventDefault(),g["list_"+e].length<g.tasck_limit){var t=g.resjsontasks[0],i="{";for(var s in t)"id"!=s?"title"==s?i=i+'"'+s+'": "NewTasck '+e+v+'",':"id_list"==s?i=i+'"'+s+'": '+Number(e)+",":"id_user"==s?i=i+'"'+s+'": '+g.user.id+",":"description"==s||"date"==s?i="date"==s?i+'"'+s+'" : "08.12.2017",':i+'"'+s+'" : "1",':"$$hashKey"!=s&&(i=i+'"'+s+'" : 1,'):i=i+'"id" : '+Math.floor(Date.now()/1e3)+",";i=i.slice(0,-1),i+="}",g.resjsontasks.push(JSON.parse(i)),a(),d(),v++}},g.def_click=function(){event.preventDefault()},g.finish_loader=function(){$("#loader").is(":visible")&&$("#loader").fadeToggle()},g.start_loader=function(){$("#loader").is(":visible")||$("#loader").fadeToggle()},g.logModels=function(){g.sortingLog=[];for(var e=0;e<g.rawScreens.length;e++){var t=g.rawScreens[e].map(function(e){return e.title+"-"+e.id_list+"|"}).join(", ");t="container "+(e+1)+": "+t,g.sortingLog.push(t)}},g.my_alert=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"def";if(0==i&&l(t,e),1==i){for(var s=null,n=0;n<g["list_"+t].length;n++)g["list_"+t][n].id==e&&(s=n);c(t,e,s)}},g.change_list=function(){g.change=!0},g.change=!1,g.rawScreens=[],g.sortingLog=[],g.resjsontasks=[],g.resgetJsonLists=[],g.sortableOptions={placeholder:"app",connectWith:".apps-container",update:function(e,t){!t.item.sortable.received&&t.item.sortable.source[0]!==t.item.sortable.droptarget[0]&&t.item.sortable.droptargetModel.length>=g.tasck_limit&&t.item.sortable.cancel()},stop:function(e,t){for(var i=function(e){g.rawScreens[e].map(function(t){t.id_list=e+1})},s=0;s<g.rawScreens.length;s++)i(s)}},g.status=[{id:1,name:"Ожидает"},{id:2,name:"В работе"},{id:3,name:"Выполнено"}],$("#dtpckr").datepicker();var p=[],m=!1;f(),g.resgetJsonLists=t.getResultFromJson("db/listsName.json"),t.list=g.resgetJsonLists,g.resjsontasks=t.getResultFromJson("db/tasks.json"),p=t.getResultFromJson("db/gridname.json"),o(g.resgetJsonLists),g.getProductList=function(){if(g.gridOptions.data=g.resultSimulatedData,g.mySelectedRows=g.gridApi.selection.getSelectedRows(),g.mySelectedRows[0]){for(var e=void 0,t=0;t<g.mySelectedRows.length;t++)e=e+"Выбрано : "+(t+1)+" ИД = "+g.mySelectedRows[t].id+", Лист = "+g.mySelectedRows[t].id_list+".\n";alert(e.slice(9))}else alert("Ничего не выбрано");n(function(){g.gridApi.selection.selectedRow&&g.gridApi.selection.selectRow(g.gridOptions.data[0])})};var v=0}angular.module("app").controller("HomeController",e).filter("id_list",function(){var e={1:"План",2:"В процессе",3:"Готово"};return function(t){return t?e[t]:""}}).filter("execution_status",function(){var e={1:"Ожидает",2:"В работе",3:"Выполнено"};return function(t){return t?e[t]:""}}),e.$inject=["UserService","JsonService","uiGridConstants","$rootScope","$timeout"]}()}]);